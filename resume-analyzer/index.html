<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Analyzer</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="uploadSection">
        <div class="uploadLeft">
            <h1>Resume Analyzer</h1>
            <h3>Evaluates resumes based on specific criteria and assigns a score to each resume.</h3>
            <div class="uploadContainer">
                <div class="uploadBox">
                    <p class="uploadText">Upload PDF files only.<br>You may upload files up to 30 MB.</p>
                    <form id="form">
                        <label for="files" class="fileLabel">Choose File</label>
                        <span id="fileName">No file chosen</span>
                        <input id="files" type="file" accept=".pdf" multiple>
                        <button type="submit">Analyze Resume</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="uploadRight">
            <img src="./images/candidate-analysis.png" alt="Analyzing Resume Illustration">
        </div>
    </div>
    <div class="resultSection">
        <div id="results"></div>
    </div>
    <script>
        const filesInput = document.getElementById('files');
        const fileNameDisplay = document.getElementById('fileName');
        const form = document.getElementById('form');
        const resultsDiv = document.getElementById('results');

        filesInput.addEventListener('change', () => {
            const fileList = Array.from(filesInput.files)
                .map(file => file.name)
                .join(', ');
            fileNameDisplay.textContent = fileList || 'No file chosen';
        });

        form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const files = filesInput.files;

    if (!files.length) {
        alert('Please upload at least one resume.');
        return;
    }

    resultsDiv.innerHTML = ''; // Clear previous results

    for (const file of files) {
        const fileReader = new FileReader();

        fileReader.onload = async function () {
            const base64File = btoa(
                new Uint8Array(fileReader.result)
                    .reduce((data, byte) => data + String.fromCharCode(byte), "")
            );

            console.log("Base64 file content:", base64File.substring(0, 100)); // Log first 100 chars

            try {
                const response = await fetch("http://localhost:5000/analyze", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ fileContent: base64File }),
                });

                const result = await response.json();

                if (response.ok) {
                    displayResults(file.name, result);
                } else {
                    console.error("Error from server:", result.error || "Unknown error");
                    alert(result.error || "An error occurred while processing the PDF.");
                }
            } catch (error) {
                alert("Unable to connect to the backend server.");
                console.error(error);
            }
        };

        fileReader.readAsArrayBuffer(file);
    }
});

        function displayResults(fileName, data) {
    if (!data) {
        console.error("No data received from server");
        return;
    }

    // Extract relevant data safely
    const {
        totalScore = 0,
        lengthScore = 0,
        keywordScore = 0,
        matchedKeywords = [],
        educationScore = 0,
        experienceScore = 0,
        experienceDetails = [],
        educationFound = false,
    } = data;

    // Generate HTML for the results
    const resultHTML = `
        <div class="resultsHeader">
            <h2>Analysis Results for ${fileName}</h2>
        </div>
        <div class="resultsContainer">
            <div id="resumeLength">
                <p><strong>Length of Resume:</strong> ${lengthScore}/5</p>
            </div>
            <div id="keywordsFound">
                <p><strong>Keywords Found:</strong> ${matchedKeywords.length ? matchedKeywords.join(", ") : "None"}</p>
                <p>Score: ${keywordScore}/10</p>
            </div>
            <div id="education">
                <p><strong>Education:</strong> ${educationFound ? "Degree Found" : "No Degree Found"}</p>
                <p>Score: ${educationScore}/5</p>
            </div>
            <div id="experience">
                <p><strong>Experience:</strong> ${experienceDetails.length ? experienceDetails.join(", ") : "No Relevant Experience"}</p>
                <p>Score: ${experienceScore}/5</p>
            </div>
            <div id="totalScore">
                <p><strong>Total Score:</strong> ${totalScore}/25</p>
            </div>
        </div>
        <hr>
    `;

    resultsDiv.innerHTML += resultHTML; // Append the results to the resultsDiv
}

    </script>
</body>
</html>